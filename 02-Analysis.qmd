---
title: "02-Analysis"
format: html
---

Questions:

- Which location has the most winning tickets sold?
  - Has that changed over time?
- Who has won the most lotteries?
- How many people who have won are from out of state? 
- How many people have won anonymously? and do more people claim anonymity if they have a larger win?
- Wins is a very broad distinction. How many low-level wins (10 dollars) vs high-level wins (1,000,000 dollars)?
- Can we see any trends relating to the courier service controversy?

## Setup

Setting up the packages -- tidyverse and janitor.

```{r}
#| label: setup
#| warning: false
#| message: false

library(tidyverse)
library(janitor)
library(scales)
library(ggthemes)
library(plotly)
```

##Importing clean data

```{r}
cleaned_lottery <- read_rds("data-processed/01-lottery.rds") |>

glimpse()
```

## of Winners

```{r}
winners_count <- cleaned_lottery |>
  count(player_id, sort = TRUE, name = "wins")
```

```{r}
cleaned_lottery |>
  filter(
    player_id == "101718882",
  )
```

Future Question: This was served as a test to see the breakdown of a single person's data. But after entering a second player id, I came across Howard Skillrud. I noticed his name when I first came across the data. He just has soooo many wins. It's about one a week, but its never anything big. 

## Difference in Wins at different locations

- Which city has the highest amount of money won?
  Grouping wins by cities with the total amount won in lottery. Largest retailer city shown as NA due to large sums often being reported anonyomously or poor recording keeping. 

```{r}
location_lottery <- cleaned_lottery |>
  group_by(retailer_city) |>
  summarize(total_amount = sum(amount_won)) |>
  arrange(desc(total_amount))

location_lottery |> head()
```

## Which retailer has the highest amount of money won?
    Breaking it down further by showing the biggest wins by retailer. Again, largest retailer city shown as NA due to large sums often being reported anonyomously or poor recording keeping. 

```{r}
retailer_lottery <- cleaned_lottery |>
  group_by(retailer_name) |>
  summarize(total_retailer_amount = sum(amount_won)) |>
  arrange(desc(total_retailer_amount))

retailer_lottery |> head()
```

## Which retailer has sold the most winning tickets?
      Breaking down how it is shown through claim numbers, rather than pure amount won. This allows for large wins to not just be highlighted but shows how often a spot has wins.

```{r}
retailer_ticket_lottery <- cleaned_lottery |>
  group_by(retailer_name) |>
  summarize(claim_number = n()) |>
  arrange(desc(claim_number))

retailer_ticket_lottery
```

## Has retailer wins changed over time?
    The lottery isn't that old of a game. I wanted to explore just how much lotteries wins have increased though the years, especially at certain spots. Many of the high winners over the years correspond with lists of retailer cash incentive programs (https://www.texaslottery.com/export/sites/lottery/Documents/retailers/46Web2_Final.pdf). This program rewards high earning spots with financial rewards. 
    
Pivoted the chart longer

```{r}
lottery_long <- cleaned_lottery |>
  
  select(yr, retailer_name, claim_number) |>
  
  group_by(retailer_name, yr) |>
  summarize(claim_number = n()) |>
  
  arrange(desc(yr))

lottery_long 
```

Pivoted the charter wider

```{r}
lottery_wide <- lottery_long |>
  pivot_wider(names_from = yr, values_from = claim_number)

lottery_wide
```

```{r}
# ggplot(lottery_long,
    #aes(x = yr, y = claim_number)) +
    #geom_point() +
    #geom_line(aes(color = retailer_name))
```

Keeping this here for reference. Trying to chart on here obviously crashed my computer... but I thought I'd try anyways to see trends in data. I'll export to datawrapper and then narrow down important years or locations for final chart. I'm curious to know what sites have high rates sold and if it's changed over the years, especially for confirmed courier service sites. 

## Narrowing wide table

Created this to see potential trends to keep an eye out for. I featured some of the current high grossers, one of which (Winner's Corner) is subject to investigations due to its involvement in courier services. 

```{r}
lottery_narrow <- lottery_long |>
  filter(retailer_name == "WINNERS CORNER TX LLC" | retailer_name == "COLONIES FOOD MART" | retailer_name == "ZEKE'S PUEBLO MEXICANO INC") |>
  pivot_wider(names_from = yr, values_from = claim_number)

lottery_narrow
```

```{r}
ggplot(lottery_narrow,
    aes(x = yr, y = claim_number)) +
    geom_point(aes(color = retailer_name)) +
    geom_line(aes(color = retailer_name))
```

## Who has won the most lotteries?

Who are the people behind most of the lottery wins? Breaking it down by claim number first due to it being a unique ID, while names can repeat. 

```{r}
largest_winner_lottery <- cleaned_lottery |>
  group_by(claim_number, first_name, last_name, claim_type) |>
  summarize(total_won = sum(amount_won)) |>
  arrange(desc(total_won))

largest_winner_lottery
```

Data Takeaway: Many of the wins listed are not names, but rather trusts. These are set up to secure anonymity for the winners, and better manage the financial assets. 

## Legal Entities

```{r}
legal_entities <- cleaned_lottery |>
  count(claim_type == "Entity")

legal_entities
```


## How many people who have won are from out of state? 

```{r}
retailer_out_of_state <- cleaned_lottery |>
  count(claimant_state, sort = TRUE, name = "# of Wins") 

retailer_out_of_state
```

Data Takeaway: The most wins of the Texas Lottery by out of state winners belongs to Oklahoma, followed by Arkansas and Louisiana. 

## How many people who have won are from out of state? 

```{r}
retailer_out_of_country <- cleaned_lottery |>
  count(claimant_country, sort = TRUE, name = "# of Wins")

retailer_out_of_country
```

Data Takeaway: Most winners of the Texas Lottery are from the United States. Behind the US is Mexico and Canada. Many of the countries listed are a part of the United States, such as Puerto Rico and American Samoa. 

## How many people have won anonymously?

```{r}
anonymous_wins <- cleaned_lottery |>
  count(anonymous_indicator)

anonymous_wins
```

Only 774 wins were declared anonymous. Anonymous wins were legalized in 2017 by the 85th regular legislative session. It allows winners of $1 million or more to remain anonymous, but still requires them to provide identification in the claiming process.

## Low-Level vs. High-Level

Wins is a very broad distinction. How many low-level wins (10 dollars) vs high-level wins (1,000,000 dollars)?

Separating wins over a million from other wins. 

```{r}
levels_wins <- cleaned_lottery |> 
  filter(
    claim_date < "2025-01-01") |>
    mutate(
      year = floor_date(claim_date, unit = "year"),
      win_level = if_else(amount_won > 1000000, "ABOVE", "BELOW")) |>
    group_by(year, win_level) |>
    summarize(total_amount = sum(amount_won)) |>
    mutate(percentage_wins = (total_amount / sum(total_amount)))

levels_wins
```

Plot it

```{r}
levels_wins |> 
  ggplot(aes(x = year, y = percentage_wins, fill = win_level)) +
  geom_col() +
  scale_y_continuous(labels = label_percent()) +
  scale_x_date(minor_breaks = breaks_width("1 year")) +
  labs(
    title = "Trend of Smaller Lottery Wins Broken Over the Past Two Years", 
    subtitle = str_wrap("Lottery wins under 1 million dollars have been on the rise since the Texas Lottery was created in 1992. It came to a height in 2022 with 68% of winners winning less than a million dollars. However, 2023 and 2024 saw a drop to 49% and 39% respectively."),
    x = "Year", y = "Percentage", 
    caption = "Source: Texas Open Data Portal",
    fill = "Above or Below A Million Dollars"
  ) + theme_light()

ggsave("figures/level_wins.png")
```

I attempted to plot it before realizing that the the difference was so significant that it didn't appear. 

Only .0003% of winners won over $1,000,000.

## ABANDONED: Lower-Level vs Low-Level

Checking on the difference between lower-level wins (anything over $100) and others. I previously checked to see how many people actually win over 1 million, but now I'm wondering how many people have won a smaller sum of money. 

```{r}
levels_low_wins <- cleaned_lottery |> 
  mutate(under_hundred = if_else(amount_won <= 100, "True", "False")) 
```

Plot It

```{r}
lottery_under_hundred_plot <- levels_low_wins |>
  count(under_hundred, name = "Wins")
```


```{r}
ggplot(lottery_under_hundred_plot,
       aes(x = under_hundred, y = Wins)
      ) +
      geom_col() +
    scale_y_continuous(labels = label_comma())
```

Data Takeaways: Nearly 39% of wins are under $100. 

## ABANDONED: Winning Numbers

```{r}
lottery_numbers <- cleaned_lottery |>
  select(claim_number, scratch_ticket_game_number) |>
  arrange(claim_number)

lottery_numbers

lottery_win_numbers <- lottery_numbers |>

  pivot_wider(names_from = claim_number, values_from = scratch_ticket_game_number)

lottery_win_numbers
```

Ongoing attempt at finding cases of one person (one claim number) buying each instance of scratch ticket numbers. However, I don't think there is enough consistent recording of the numbers to include. Currently, results show each recorded win number. 

## ABANDONED: Rook TX

I read this Houston Chronicle Article regarding Rook TX which is buying up large amounts of lottery tickets to increase their chances. I wanted to see just how many they bought. Still looking into this.

https://www.houstonchronicle.com/politics/texas/article/texas-lottery-jackpot-details-emerge-21114267.php

```{r}
lottery_rook <- cleaned_lottery |>
  
  select(last_name, claimant_name_and_player_id, claim_number, amount_won) |>
  filter(str_detect(last_name, "ROOK TX"))

lottery_rook
```

## ABANDONED: Side Quest

```{r}
lottery_beast <- cleaned_lottery |>
  
  select(last_name, claimant_name_and_player_id, claim_number, amount_won, claim_type, claim_date) |>
  filter(str_detect(last_name, "MRBEAST"))

lottery_beast
```

Came across this. Couldn't find any record with the state abt this llc. I think its an LLC based in NC. Ignoring this for now, especially since it's from a few years ago.  

## Total payouts by year

```{r}
yearly_payouts <- cleaned_lottery |>
  
  filter(
    claim_date < "2025-01-01"
  ) |>
  group_by(year = floor_date(claim_date, unit = "year")) |>
  summarize(yearly_total = sum(amount_won))
  
yearly_payouts
```

```{r}
yearly_payouts |>
  summarize(yearly_average = mean(yearly_total))
```

## Plot the chart

```{r}
payouts_plot <- ggplot(yearly_payouts, aes(x = year, y = yearly_total)) +
  geom_col() +
  
  scale_y_continuous(labels = label_dollar(scale_cut = cut_long_scale())) + 
  scale_x_date(minor_breaks = breaks_width("1 year")) +
  labs(
    title = "Since 2022, lottery payouts have nearly doubled.", 
    subtitle = str_wrap("Since the lottery was created in 1992, the total yearly payout remained largely similar until recently. In 2024, the most recent recorded year, more than 870 million dollars were won, nearly doubling the total from 2022. Throughout the years, the average wins would be around 425 million."),
    x = "Year", y = "Total Payout", 
    caption = "Source: Texas Open Data Portal"
  ) + theme_light()

payouts_plot |> ggplotly()

ggsave("figures/payouts_plot.png")
```

![](figures/payouts_plot.png)



